(this.webpackJsonpf2e_2_bikeland=this.webpackJsonpf2e_2_bikeland||[]).push([[0],{13:function(e,t,a){},14:function(e,t,a){},17:function(e,t,a){},18:function(e,t,a){"use strict";a.r(t);var n=a(1),c=a.n(n),i=a(7),r=a.n(i),s=(a(13),a(2)),o=(a(14),a.p+"static/media/logo-light.0c6a71ad.svg"),l=(a.p,a.p+"static/media/icon-bicycle-400.b9d2a608.svg"),u=(a.p,a.p,a.p,a(0));function p(){return Object(u.jsx)("h1",{className:"logo",children:Object(u.jsx)("a",{target:"_blank",rel:"noreferrer",href:"https://github.com/krli07717/bikeland",children:Object(u.jsx)("img",{src:o,alt:"Bikeland"})})})}var b=function(e){var t=Object(n.useState)(!1),a=Object(s.a)(t,2);return a[0],a[1],Object(u.jsx)("header",{children:Object(u.jsx)("div",{className:"header_wrapper",children:Object(u.jsx)(p,{})})})},d=a(3),h=a.n(d),j=a(5),m=(a(17),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{enableHighAccuracy:!0,timeout:5e3,maximumAge:0};return new Promise((function(t,a){navigator.geolocation.getCurrentPosition((function(e){t([e.coords.latitude,e.coords.longitude])}),(function(e){a(e)}),e)}))}),g=a(8);function v(){var e=(new Date).toGMTString(),t=new g.a("SHA-1","TEXT");return t.setHMACKey("vjTEyBOiAfZny92QM76fuhDGG9M","TEXT"),t.update("x-date: "+e),{Authorization:'hmac username="cf82a65ff157414d806715c121e642bd", algorithm="hmac-sha1", headers="x-date", signature="'+t.getHMAC("B64")+'"',"X-Date":e}}function y(e){return f.apply(this,arguments)}function f(){return(f=Object(j.a)(h.a.mark((function e(t){var a,n,c,i,r,o,l,u,p,b,d,j;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=Object(s.a)(t,2),n=a[0],c=a[1],i="https://ptx.transportdata.tw/MOTC/v2/Bike/Station/NearBy?$top=30&$spatialFilter=nearby(".concat(n,",").concat(c,",1000)&$format=JSON"),r="https://ptx.transportdata.tw/MOTC/v2/Bike/Availability/NearBy?$top=30&$spatialFilter=nearby(".concat(n,",").concat(c,",1000)&$format=JSON"),e.next=6,Promise.allSettled([k(i),k(r)]);case 6:for(o=e.sent,l=[],u=[o[0].value,o[1].value],p=u[0],b=u[1],d=0;d<p.length;d++)j={stationId:p[d].StationUID,stationName:p[d].StationName.Zh_tw,stationAddress:p[d].StationAddress.Zh_tw,stationPosition:{lat:p[d].StationPosition.PositionLat,lng:p[d].StationPosition.PositionLon},serviceStatus:b[d].ServiceStatus,availableRentBikes:b[d].AvailableRentBikes,availableReturnBikes:b[d].AvailableReturnBikes,srcUpdateTime:b[d].SrcUpdateTime},l.push(j);return e.abrupt("return",l);case 13:throw e.prev=13,e.t0=e.catch(0),e.t0;case 16:case"end":return e.stop()}}),e,null,[[0,13]])})))).apply(this,arguments)}function k(e){return O.apply(this,arguments)}function O(){return(O=Object(j.a)(h.a.mark((function e(t){var a,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t,{headers:v()});case 3:return a=e.sent,e.next=6,a.json();case 6:return n=e.sent,e.abrupt("return",n);case 10:throw e.prev=10,e.t0=e.catch(0),e.t0;case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}var x=a.p+"static/media/icon-bicycle-500.9f48f63e.svg",N=a.p+"static/media/icon-bicycle-red.90c43663.svg",w=a.p+"static/media/icon-bicycle-grey.e2b1d7d4.svg",B=a.p+"static/media/icon-parking.0d06e565.svg",_=a.p+"static/media/icon-parking-red.0b602e67.svg",R=a.p+"static/media/icon-parking-grey.84ff3ab7.svg",S=a.p+"static/media/icon-user-position-mobile.dbd42942.svg";function T(e){var t=e.source,a=e.resultNone,n=e.resultFew,c=e.resultNormal;return 0===t?a:t<=5?n:c}var F=a(4),A=a.n(F);function C(e){var t=e.userPosition,a=e.bikesAvailable,c=e.isFindingBikes,i=Object(n.useRef)(null),r=Object(n.useRef)(null),s=Object(n.useRef)([]);return Object(n.useEffect)((function(){i.current||(i.current=A.a.map("bike_map",{attributionControl:!1,zoomControl:!1,center:t,zoom:15,layers:[A.a.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'})]}))}),[]),Object(n.useEffect)((function(){if(i.current){r.current&&i.current.removeLayer(r.current),i.current.setView(t,15);var e=A.a.icon({iconUrl:S,iconSize:[56,56]});r.current=A.a.marker(t,{icon:e}),r.current.addTo(i.current)}}),[t]),Object(n.useEffect)((function(){i.current&&(s.current.forEach((function(e){i.current.removeLayer(e)})),s.current=[],a.forEach((function(e,t){var a=T({source:e.availableRentBikes,resultNone:"none",resultFew:"few",resultNormal:""}),n=T({source:e.availableReturnBikes,resultNone:"none",resultFew:"few",resultNormal:""}),r=T({source:e.availableRentBikes,resultNone:"none",resultFew:"few",resultNormal:""}),o=T({source:e.availableReturnBikes,resultNone:"none",resultFew:"few",resultNormal:""}),l=T({source:e.availableRentBikes,resultNone:"<img src=".concat(w,' alt="bicycle icon" />'),resultFew:"<img src=".concat(N,' alt="bicycle icon" />'),resultNormal:"<img src=".concat(x,' alt="bicycle icon" />')}),u=T({source:e.availableReturnBikes,resultNone:"<img src=".concat(R,' alt="parking icon" />'),resultFew:"<img src=".concat(_,' alt="parking icon" />'),resultNormal:"<img src=".concat(B,' alt="parking icon" />')});s.current[t]=A.a.marker([e.stationPosition.lat,e.stationPosition.lng],{icon:A.a.divIcon({html:'<span class="bikeMarker_number typography-bold typography-button">'.concat(c?e.availableRentBikes:e.availableReturnBikes,"</span>"),className:"bikeMarker ".concat(c?a:n)})});var p=/.*T(\d*:\d*)/g.exec(e.srcUpdateTime)[1],b='<div class="bikeMarkers_popup">\n          <h3 class="typography-bold typography-button">'.concat(e.stationName,'</h3>\n          <div class="popup_info">\n              <div class="popup_bikes ').concat(r,'">\n                  ').concat(l,'\n                  <span class="quantity typography-bold typography-button">').concat(e.availableRentBikes,'</span>\n              </div>\n              <div class="popup_parks ').concat(o,'">\n                  ').concat(u,'\n                  <span class="quantity typography-bold typography-button">').concat(e.availableReturnBikes,'</span>\n              </div>\n              <span class="update_time typography-medium typography-caption">').concat(p,"\u66f4\u65b0</span>\n          </div>\n        </div>");s.current[t].bindPopup(b,{className:"popupClass"}),s.current[t].addTo(i.current)})))}),[a,c]),Object(n.useEffect)((function(){return function(){i.current&&(i.current.remove(),i.current=null)}}),[]),Object(u.jsx)("div",{id:"bike_map"})}var M=a.p+"static/media/icon-collapse-top.269c0cf4.svg",U=a.p+"static/media/icon-collapse-down.a7d0baff.svg",P=a.p+"static/media/icon-sort.f7f91b6d.svg",E=a.p+"static/media/icon-geolocation.7783d3dc.svg",L=a.p+"static/media/icon-bicycle-white.60cb5498.svg",$=a.p+"static/media/icon-parking-white.95eab66a.svg",z=Object(u.jsx)("h3",{className:"no_results typography-bold typography-h5",children:"\b\u6c92\u6709\u641c\u5c0b\u7d50\u679c"});function I(e){var t=e.bikesAvailable,a=e.keyword,n=e.sortMethod,c=t.filter((function(e){return!a||(e.stationName.includes(a)||e.stationAddress.includes(a))})).sort({0:function(e,t){return 0},1:function(e,t){return t.availableRentBikes-e.availableRentBikes},2:function(e,t){return t.availableReturnBikes-e.availableReturnBikes},3:function(e,t){var a=/.*T(\d*)/g.exec(e.srcUpdateTime)[1],n=/.*T\d*:(\d*)/g.exec(e.srcUpdateTime)[1],c=/.*T(\d*)/g.exec(t.srcUpdateTime)[1],i=/.*T\d*:(\d*)/g.exec(t.srcUpdateTime)[1];return a===c?i-n:c-a}}[n]).map((function(e){var t=1!==e.serviceStatus?"\u672a\u71df\u904b":e.availableRentBikes>0&&e.availableReturnBikes>0?"\u53ef\u501f\u53ef\u9084":e.availableReturnBikes>0?"\u53ea\u53ef\u505c\u8eca":"\u53ea\u53ef\u501f\u8eca",a=1!==e.serviceStatus?"off":0===e.availableRentBikes||0===e.availableReturnBikes?"limited":"",n=T({source:e.availableRentBikes,resultNone:"none",resultFew:"few",resultNormal:""}),c=T({source:e.availableReturnBikes,resultNone:"none",resultFew:"few",resultNormal:""}),i=T({source:e.availableRentBikes,resultNone:Object(u.jsx)("img",{src:w,alt:"bicycle icon"}),resultFew:Object(u.jsx)("img",{src:N,alt:"bicycle icon"}),resultNormal:Object(u.jsx)("img",{src:x,alt:"bicycle icon"})}),r=T({source:e.availableReturnBikes,resultNone:Object(u.jsx)("img",{src:R,alt:"parking icon"}),resultFew:Object(u.jsx)("img",{src:_,alt:"parking icon"}),resultNormal:Object(u.jsx)("img",{src:B,alt:"parking icon"})}),s=/.*T(\d*:\d*)/g.exec(e.srcUpdateTime)[1],o=/(YouBike)?(.*)/g.exec(e.stationName)[2];return Object(u.jsxs)("div",{className:"bike_result",children:[Object(u.jsxs)("div",{className:"info",children:[Object(u.jsx)("h3",{className:"typography-bold typography-button",children:o}),Object(u.jsx)("span",{className:"status ".concat(a," typography-medium typography-caption"),children:t}),Object(u.jsx)("span",{className:"distance typography-medium typography-caption",children:"".concat(s," \u66f4\u65b0")})]}),Object(u.jsxs)("div",{className:"available",children:[Object(u.jsxs)("div",{className:"available_bikes ".concat(n),children:[i,Object(u.jsx)("span",{className:"typography-medium typography-button",children:"\u53ef\u79df\u501f"}),Object(u.jsx)("span",{className:"quantity typography-bold typography-h5",children:e.availableRentBikes})]}),Object(u.jsxs)("div",{className:"available_parks ".concat(c),children:[r,Object(u.jsx)("span",{className:"typography-medium typography-button",children:"\u53ef\u505c\u8eca"}),Object(u.jsx)("span",{className:"quantity typography-bold typography-h5",children:e.availableReturnBikes})]})]})]},e.stationId)}));return c.length?c:z}function q(e){var t=e.handleLocateUser,a=e.bikesAvailable,c=e.isLocatingUser,i=e.handleFindingType,r=e.isFindingBikes,o=Object(n.useState)(!1),p=Object(s.a)(o,2),b=p[0],d=p[1],h=Object(n.useState)(""),j=Object(s.a)(h,2),m=j[0],g=j[1],v=Object(n.useState)(0),y=Object(s.a)(v,2),f=y[0],k=y[1];var O=Object(u.jsx)("div",{className:"collapse",onClick:function(){d((function(e){return!e}))},children:b?Object(u.jsx)("img",{src:U,alt:"collapse down icon"}):Object(u.jsx)("img",{src:M,alt:"collapse top icon"})}),x=Object(u.jsx)("div",{className:"locating_message",children:Object(u.jsx)("span",{className:"typography-bold typography-h4",children:"\u5b9a\u4f4d\u4e2d"})}),N=Object(u.jsx)("button",{className:"geolocation",disabled:!!c,onClick:t,children:Object(u.jsx)("img",{src:E,alt:"geo location icon"})});return Object(u.jsxs)("div",{className:"bikemap_info",children:[Object(u.jsxs)("div",{className:"find_type_wrapper",children:[Object(u.jsxs)("label",{htmlFor:"find_bikes",children:[Object(u.jsx)("input",{type:"radio",name:"find_type",id:"find_bikes",checked:r,onChange:function(){},hidden:!0}),Object(u.jsxs)("button",{className:"find_type typography-bold typography-button",onClick:i,children:[Object(u.jsx)("div",{className:"find_type_img",children:r?Object(u.jsx)("img",{src:L,alt:"bicycle white icon"}):Object(u.jsx)("img",{src:l,alt:"bicycle white icon"})}),"\u627e\u55ae\u8eca"]})]}),Object(u.jsxs)("label",{htmlFor:"find_parks",children:[Object(u.jsx)("input",{type:"radio",name:"find_type",id:"find_parks",checked:!r,onChange:function(){},hidden:!0}),Object(u.jsxs)("button",{className:"find_type typography-bold typography-button",onClick:i,children:[Object(u.jsx)("div",{className:"find_type_img",children:r?Object(u.jsx)("img",{src:B,alt:"parking icon"}):Object(u.jsx)("img",{src:$,alt:"parking icon"})}),"\u627e\u8eca\u4f4d"]})]})]}),c?x:null,Object(u.jsxs)("div",{className:"results_list ".concat(b?"expand":""),children:[N,O,Object(u.jsxs)("div",{className:"filter",children:[Object(u.jsx)("input",{className:"typography-medium typography-caption",type:"search",placeholder:"\u641c\u5c0b\u7ad9\u9ede\u6216\u9130\u8fd1\u5730\u9ede",value:m,onChange:function(e){g(e.target.value)}}),Object(u.jsxs)("button",{className:"sort typography-bold typography-caption",onClick:function(){k((function(e){return++e%4}))},children:[Object(u.jsx)("img",{src:P,alt:"sort icon"}),"\u6392\u5e8f"]})]}),Object(u.jsx)("div",{className:"results",children:Object(u.jsx)(I,{keyword:m,sortMethod:f,bikesAvailable:a})})]})]})}var D=function(e){var t=Object(n.useState)([25.03746,121.564558]),a=Object(s.a)(t,2),c=a[0],i=a[1],r=Object(n.useState)([]),o=Object(s.a)(r,2),l=o[0],p=o[1],b=Object(n.useState)(!1),d=Object(s.a)(b,2),g=d[0],v=d[1],f=Object(n.useState)(!0),k=Object(s.a)(f,2),O=k[0],x=k[1];function N(){return(N=Object(j.a)(h.a.mark((function e(){var t;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,v(!0),e.next=4,m();case 4:t=e.sent,v(!1),i(t),e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(0),v(!1),e.t0;case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}return Object(n.useEffect)((function(){function e(){return e=Object(j.a)(h.a.mark((function e(t){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,y(t);case 3:a=e.sent,p(a),e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(0),e.t0;case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))),e.apply(this,arguments)}!function(t){e.apply(this,arguments)}(c)}),[c]),Object(u.jsxs)("main",{children:[Object(u.jsx)(C,{userPosition:c,bikesAvailable:l,isFindingBikes:O}),Object(u.jsx)(q,{handleLocateUser:function(){return N.apply(this,arguments)},bikesAvailable:l,isLocatingUser:g,handleFindingType:function(){x((function(e){return!e}))},isFindingBikes:O})]})};var H=function(){return Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)(b,{}),Object(u.jsx)(D,{})]})};r.a.render(Object(u.jsx)(c.a.StrictMode,{children:Object(u.jsx)(H,{})}),document.getElementById("root"))}},[[18,1,2]]]);
//# sourceMappingURL=main.8353937e.chunk.js.map